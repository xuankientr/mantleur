# ðŸš€ DEPLOYMENT CHECKLIST - MANTLEUR PAYMENT SYSTEM

## âœ… Pre-Deployment Checklist

### 1. **Code Preparation**
- [x] All features tested locally
- [x] Payment system working (VNPay integration)
- [x] Withdrawal system with bank info working
- [x] Admin panel functional
- [x] Exchange rates consistent (100 VND = 1 Coin)
- [x] Database schema updated with payment tables
- [x] Environment variables configured

### 2. **Files Ready for Deployment**
- [x] `docs/render.yaml` - Updated with VNPay config
- [x] `backend/setup-production-db.js` - Database setup script
- [x] `backend/package.json` - Dependencies updated
- [x] `frontend/package.json` - Dependencies updated
- [x] Database schema with Transaction and Withdrawal tables

### 3. **Environment Variables (Production)**
```bash
# Backend Environment Variables
NODE_ENV=production
DATABASE_URL=<postgresql-connection-string>
JWT_SECRET=<auto-generated>
CORS_ORIGIN=https://mantleur-frontend.onrender.com
VNP_TMN_CODE=7DZ9914S
VNP_HASH_SECRET=2R7SDKR0VZ7ERVSK6TWM51F5T0CDBRO2
VNP_URL=https://sandbox.vnpayment.vn/paymentv2/vpcpay.html
VNP_RETURN_URL=https://mantleur-backend.onrender.com/api/payments/return
FRONTEND_URL=https://mantleur-frontend.onrender.com

# Frontend Environment Variables
VITE_API_URL=https://mantleur-backend.onrender.com
```

## ðŸš€ Deployment Steps

### Step 1: Push to GitHub
```bash
git add .
git commit -m "Add payment system with VNPay integration"
git push origin main
```

### Step 2: Deploy on Render
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Use existing services or create new ones
3. Update environment variables with VNPay config
4. Deploy backend first, then frontend

### Step 3: Setup Database
1. After backend deployment, run database setup:
```bash
# In Render backend shell
cd backend
node setup-production-db.js
```

### Step 4: Test Production
1. **Backend Health**: `https://mantleur-backend.onrender.com/api/health`
2. **Frontend**: `https://mantleur-frontend.onrender.com`
3. **Login Test**: 
   - Admin: `admin@example.com` / `admin123`
   - User: `usertest@example.com` / `usertest123`
4. **Payment Test**: Try deposit with VNPay
5. **Withdrawal Test**: Try withdrawal with bank info
6. **Admin Panel**: Test `/admin/withdrawals`

## ðŸ”§ Production Features

### âœ… Payment System
- VNPay Sandbox integration
- Deposit with 100 VND = 1 Coin rate
- Transaction tracking
- Payment callback handling

### âœ… Withdrawal System
- Bank information collection
- Admin approval workflow
- Manual transfer simulation
- Status tracking (pending â†’ approved â†’ completed)

### âœ… Admin Panel
- Withdrawal management
- Bank details display
- Approval/rejection workflow
- Transaction ID generation

### âœ… Security
- JWT authentication
- Input validation
- CORS configuration
- Environment variable protection

## ðŸ“Š Monitoring

### Health Checks
- Backend: `/api/health`
- Database: Connection status
- Payment: VNPay callback logs
- Withdrawal: Admin panel access

### Logs to Monitor
- Payment creation logs
- VNPay callback processing
- Withdrawal request handling
- Admin actions

## ðŸŽ¯ Post-Deployment Testing

### 1. **Authentication**
- [ ] User login works
- [ ] Admin login works
- [ ] JWT tokens valid

### 2. **Payment System**
- [ ] Deposit creation works
- [ ] VNPay URL generation works
- [ ] Payment callback processing works
- [ ] Balance updates correctly

### 3. **Withdrawal System**
- [ ] Withdrawal request creation works
- [ ] Bank info collection works
- [ ] Admin can view requests
- [ ] Admin can approve/reject
- [ ] Status updates work

### 4. **Admin Panel**
- [ ] Admin panel accessible
- [ ] Withdrawal list loads
- [ ] Bank details display correctly
- [ ] Actions work (approve/reject/complete)

## ðŸš¨ Troubleshooting

### Common Issues
1. **Database Connection**: Check DATABASE_URL format
2. **VNPay Integration**: Verify environment variables
3. **CORS Issues**: Check CORS_ORIGIN setting
4. **Frontend API**: Verify VITE_API_URL

### Debug Commands
```bash
# Check backend logs
# In Render Dashboard â†’ Backend Service â†’ Logs

# Check database
# In Render Dashboard â†’ Database â†’ Connect

# Test API endpoints
curl https://mantleur-backend.onrender.com/api/health
```

## ðŸŽ‰ Success Criteria

- [ ] All services deployed successfully
- [ ] Database setup complete
- [ ] Payment system functional
- [ ] Withdrawal system functional
- [ ] Admin panel accessible
- [ ] All tests passing
- [ ] No critical errors in logs

## ðŸ“ž Support

If issues occur:
1. Check Render Dashboard logs
2. Verify environment variables
3. Test API endpoints manually
4. Check database connectivity
5. Review VNPay integration logs

---

**ðŸš€ READY FOR PRODUCTION DEPLOYMENT!**
